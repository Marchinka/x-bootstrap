<script src="./../../node_modules/x-tag/dist/x-tag-core.js"></script>
<link rel="import" href="./../behaviours/input-autocomplete-element-base-behaviour.html">

<template id="input-autocomplete-template">
    <div class="form-group">
        <div class="dropdown">
            <label></label>
            <input type="text" class="form-control"/>
            <ul class="dropdown-menu" style="width: 100%"></ul>
        </div>
        <span class="help-block"></span>
    </div>
</template>

<script>
(function(window, document) {
    var thatDoc = document;
    var thisDoc = document._currentScript.ownerDocument;
    var template = thisDoc.querySelector('#input-autocomplete-template').content;

    var baseObject = {
        lifecycle: {
            created: function() {
                this.innerHTML = '';
                var clone = thatDoc.importNode(template, true);
                this._getRenderingRoot().appendChild(clone);
                this.containerDiv = this._selectInRenderingRoot('.form-group');
                this.labelTag = this._selectInRenderingRoot('label');
                this.input = this._selectInRenderingRoot('input');
                this.errorSpan = this._selectInRenderingRoot('span');
                this.dropdown = this._selectInRenderingRoot('.dropdown');
                this.dropdownMenu = this._selectInRenderingRoot('.dropdown-menu');      
                this.render();
            },
            inserted: function() {
                this._fetchData();                
            },            
            attributeChanged: function(attributeName) {
                this.render();
            }
        },
        methods: {
            render: function() {
                this.labelTag.htmlFor = this.field;
                this.labelTag.textContent = this.label;
                this.input.placeholder = this.placeholder;
                this.input.id = this.field;
                this.input.name = this.field;
                this.input.value = this.value;
                this.input.disabled = this.disabled;
                if (this.error) {
                    this.errorSpan.textContent = this.error;
                    this.containerDiv.className = "form-group has-error";
                } else {
                    this.errorSpan.textContent = '';
                    this.containerDiv.className = "form-group";
                }                    
            }                     
        },
        events: {
            keyup: function () {
                this.value = this.input.value;
                this._fetchData();
            }
        }
    };

    var protoTag = xtag.merge(xBootstrap.getInputAutocompleteElementBase(), baseObject);
    xtag.register('input-autocomplete', protoTag);
})(window, document);
</script>

<link rel="import" href="./dropdown-option.html">