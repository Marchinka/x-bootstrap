<script src="./../../node_modules/x-tag/dist/x-tag-core.js"></script>
<script src="./../behaviours/input-behaviours.js"></script>

<script>
(function(window, document) {
    var thatDoc = document;
    var thisDoc = document._currentScript.ownerDocument;
    var element = {
        accessors: {
            type: {
                attribute: {},
                get: function() {
                    return this.getAttribute('type');
                },
                set: function(value) {
                    this.xtag.data.type = value;
                }
            }           
        },
        lifecycle: {
            created: function() {
                var firstChild = this._getRenderingRoot().firstElementChild;
                if (firstChild) {
                    this.listItemTemplate = firstChild.cloneNode(true);    
                }
                
                this.innerHTML = '';
            }
        },
        methods: {
            appendData: function (data) {
                if (!data) {
                    throw new Error("Data not defined.");
                }

                if (!data.length && data.length != 0) {
                    throw new Error("Data must be a collection.");   
                }

                for (var i = 0; i < data.length; i++) {
                    var elementData  = data[i];
                    var domElement = this._getChildElement(elementData);
                    this._getRenderingRoot().appendChild(domElement);
                }                
            },
            renderData: function (data) {
                this.innerHTML = '';
                this.appendData(data);
            },
            emptyCollection: function () {
                this.innerHTML = '';
            },
            _getChildElement: function (elementData) {
                var domElement;
                if (this.listItemTemplate) {
                    domElement = this.listItemTemplate.cloneNode(true);
                } else if(this.type) {
                    domElement = document.createElement(this.type);                    
                } else {
                    throw new Error("Neither 'type' property nor inner element defined in <collection-elements/>.");
                }

                for (var attrname in elementData) { 
                    domElement[attrname] = elementData[attrname];
                }                     
                return domElement;
            }
        }
    };
    xtag.register('collection-elements', xtag.merge(FormBehaviours.elementBase, element));
})(window, document);
</script>
